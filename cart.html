<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NOIR — Cart</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="logo">NOIR</div>
    <button class="menu-toggle" aria-label="Open menu">☰</button>
    <nav class="nav-desktop">
      <a href="index.html">Shop</a>
      <a href="collections.html">Collections</a>
      <a href="atelier.html">Atelier</a>
      <a href="journal.html">Journal</a>
      <a href="cart.html" class="active">Cart (0)</a>
    </nav>
  </header>

  <!-- MOBILE MENU -->
  <nav class="nav-mobile" id="navMenu">
    <button class="close-menu" aria-label="Close menu">×</button>
    <ul>
      <li><a href="index.html">Shop</a></li>
      <li><a href="collections.html">Collections</a></li>
      <li><a href="atelier.html">Atelier</a></li>
      <li><a href="journal.html">Journal</a></li>
      <li><a href="cart.html">Cart (0)</a></li>
    </ul>
  </nav>

  <main>
    <section class="section">
      <h2 class="section-title animate-on-scroll">Your Cart</h2>
      <div id="cart-items" class="grid"></div>
      <div class="cart-summary animate-on-scroll">
        <h3>Total: <span id="cart-total">$0</span></h3>
        <button class="btn" id="checkout">Checkout</button>
      </div>

      <h2 class="section-title animate-on-scroll">Saved for Later</h2>
      <div id="saved-items" class="grid"></div>
    </section>
  </main>

  <footer>
    <p>© 2025 NOIR — All Rights Reserved</p>
  </footer>

  <!-- Toast Notification -->
  <div id="toast" class="toast">Added to cart!</div>

  <script>
    // Update cart count in header on every page
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      const cartLinks = document.querySelectorAll('a[href="cart.html"]');
      cartLinks.forEach(link => {
        link.textContent = `Cart (${count})`;
      });
    }
    updateCartCount();
    window.addEventListener('storage', updateCartCount);

    // Header scroll effect
    window.addEventListener('scroll', () => {
      document.querySelector('header').classList.toggle('scrolled', window.scrollY > 100);
    });

    // Mobile menu toggle
    const menuToggle = document.querySelector('.menu-toggle');
    const navMenu = document.querySelector('#navMenu');
    const closeMenu = document.querySelector('.close-menu');

    menuToggle.addEventListener('click', () => navMenu.classList.add('active'));
    closeMenu.addEventListener('click', () => navMenu.classList.remove('active'));

    // Scroll animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));

    // Cart functionality
    function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const saved = JSON.parse(localStorage.getItem('saved') || '[]');
      const cartItems = document.getElementById('cart-items');
      const savedItems = document.getElementById('saved-items');
      const cartTotal = document.getElementById('cart-total');

      cartItems.innerHTML = '';
      savedItems.innerHTML = '';
      let total = 0;

      cart.forEach((item, index) => {
        const card = createCartCard(item, index, false);
        cartItems.appendChild(card);
        total += item.price * item.quantity;
      });

      saved.forEach((item, index) => {
        const card = createCartCard(item, index, true);
        savedItems.appendChild(card);
      });

      cartTotal.textContent = `$${total.toFixed(2)}`;
      updateCartCount();
    }

    function createCartCard(item, index, isSaved) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-image"></div>
        <div class="card-content">
          <h3>${item.name}</h3>
          <p>${item.description}</p>
          <div class="price">$${item.price}</div>
          <div class="quantity">
            <button class="qty-btn minus" data-index="${index}" data-saved="${isSaved}">-</button>
            <span class="qty-number">${item.quantity}</span>
            <button class="qty-btn plus" data-index="${index}" data-saved="${isSaved}">+</button>
          </div>
          <button class="btn remove" data-index="${index}" data-saved="${isSaved}">Remove</button>
          <button class="btn save-later" data-index="${index}" data-saved="${isSaved}">${isSaved ? 'Move to Cart' : 'Save for Later'}</button>
        </div>
      `;
      return card;
    }

    // Unified click handler for all buttons
    document.addEventListener('click', (e) => {
      const isSaved = e.target.dataset.saved === 'true';
      const index = e.target.dataset.index;
      let cartKey = isSaved ? 'saved' : 'cart';
      let otherKey = isSaved ? 'cart' : 'saved';
      let cart = JSON.parse(localStorage.getItem(cartKey) || '[]');

      if (e.target.classList.contains('remove')) {
        cart.splice(index, 1);
      } else if (e.target.classList.contains('save-later')) {
        const item = cart.splice(index, 1)[0];
        let other = JSON.parse(localStorage.getItem(otherKey) || '[]');
        other.push(item);
        localStorage.setItem(otherKey, JSON.stringify(other));
      } else if (e.target.classList.contains('qty-btn')) {
        const action = e.target.classList.contains('plus') ? 'plus' : 'minus';
        if (action === 'plus') {
          cart[index].quantity += 1;
        } else if (action === 'minus') {
          if (cart[index].quantity > 1) {
            cart[index].quantity -= 1;
          } else {
            cart.splice(index, 1); // Quantity 0 = remove
          }
        }
      }

      localStorage.setItem(cartKey, JSON.stringify(cart));
      loadCart();
    });

    document.getElementById('checkout').addEventListener('click', () => {
      alert('Proceeding to checkout...');
    });

    loadCart();
  </script>
</body>
</html>
